language: c
compiler:
  - gcc
  - clang   
env:
    global:
        - LIBUV_VER=1.11.0
before_install: 
    - wget https://github.com/libuv/libuv/archive/v$LIBUV_VER.tar.gz 
    - tar xvf v$LIBUV_VER.tar.gz 
    - pushd libuv-$LIBUV_VER
    - ./autogen.sh && ./configure --prefix=/usr --disable-static && make
    - sudo make install
    - popd
    - pip install --user cpp-coveralls
script: mkdir -p build/debug && cd build/debug && rm CMakeCache.txt && cmake -DCMAKE_BUILD_TYPE=Debug -DENABLE_GCOV=ON ../.. && make && make test 
sudo: required
after_success:
  - bash <(curl -s https://codecov.io/bash)
  - coveralls --exclude lib --exclude tests --gcov-options '\-lp'
